# ============================================================================
# 跨交易所資金費率套利平台 - 環境變數配置
# ============================================================================
#
# 📖 部署指南：請參考 docs/deployment/README.md
#
# ⚠️ 重要提示：
# 1. 請勿將包含真實憑證的 .env 檔案提交到版本控制
# 2. JWT_SECRET 和 ENCRYPTION_KEY 必須使用強隨機字串
# 3. 生產環境請務必設定 NODE_ENV=production
# 4. 詳細說明請見：docs/deployment/environment-variables.md
#
# ============================================================================

# ============================================================================
# 應用程式環境設定
# ============================================================================
# 執行環境：development（開發）、production（正式）
NODE_ENV=development

# Node.js V8 Heap 記憶體上限設定
# 說明：設定 V8 引擎的最大 heap 大小（單位：MB）
# 預設值：約 2048 MB（依系統而異）
# 建議值：
# - 開發環境：2048（2 GB）
# - 正式環境：4096（4 GB）或更高
# ⚠️ 注意：設定值不應超過主機可用記憶體的 70-80%
# Zeabur/Railway 部署時，需在 Dashboard 設定此環境變數
NODE_OPTIONS=--max-old-space-size=4096

# 伺服器 Port（預設 3000）
# Zeabur/Railway 會自動設定，通常不需要修改
PORT=3000

# 伺服器 Hostname
# 本地開發：localhost
# Zeabur/Railway：0.0.0.0（監聽所有介面）
HOSTNAME=localhost

# ============================================================================
# 資料庫設定
# ============================================================================
# PostgreSQL 連線字串
# 格式：postgresql://使用者名稱:密碼@主機:Port/資料庫名稱?schema=schema名稱
#
# 本地開發：使用 Docker Compose 啟動的 PostgreSQL
# 執行：pnpm docker:up
#
# 正式環境：替換為您的 PostgreSQL 主機位址和憑證
DATABASE_URL="postgresql://arbitrage_user:arbitrage_pass@localhost:5432/arbitrage_db?schema=public"

# ============================================================================
# Redis 設定（選用 - 用於快取）
# ============================================================================
# Redis 連線字串
# 本地開發：使用 Docker Compose 啟動的 Redis
# 執行：pnpm docker:up
REDIS_URL="redis://localhost:6379"

# ============================================================================
# Web 平台認證與安全設定（必填）
# ============================================================================
# JWT Secret 金鑰（用於用戶登入 Token 簽署）
#
# 如何產生：在終端機執行以下命令
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# 要求：至少 32 字元（建議使用上述命令產生 64 字元的隨機字串）
#
# ⚠️ 警告：
# - 此金鑰必須保密，不可外洩
# - 變更此金鑰會導致所有用戶需要重新登入
# - 正式環境請務必使用強隨機金鑰
JWT_SECRET=your-jwt-secret-key-at-least-32-characters-long-replace-this

# JWT Token 有效期限
# 格式：數字 + 單位（s=秒, m=分鐘, h=小時, d=天）
# 範例：7d = 7 天, 24h = 24 小時, 3600s = 3600 秒
JWT_EXPIRES_IN=7d

# API Key 加密金鑰（用於加密儲存用戶的交易所 API Key）
#
# 如何產生：在終端機執行以下命令
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# 要求：必須是 32 bytes（64 個十六進位字元）
#
# ⚠️ 警告：
# - 此金鑰用於加密用戶的交易所 API Key，極度重要
# - 遺失此金鑰會導致無法解密已儲存的 API Key
# - 變更此金鑰會導致所有已儲存的 API Key 無法解密
# - 建議備份此金鑰到安全的位置
ENCRYPTION_KEY=your-32-byte-encryption-key-replace-this-64-hex-chars-exactly

# ============================================================================
# Next.js 公開 URL 設定（必填 - 用於前端）
# ============================================================================
# API 端點 URL（前端會呼叫此 URL）
# 本地開發：http://localhost:3000/api
# 正式環境：https://your-domain.com/api
NEXT_PUBLIC_API_URL=http://localhost:3000/api

# WebSocket 伺服器 URL（前端會連線到此 URL）
# 本地開發：http://localhost:3000
# 正式環境：https://your-domain.com
NEXT_PUBLIC_WS_URL=http://localhost:3000

# ============================================================================
# 交易所 API 憑證（用於 CLI 交易機器人）
# ============================================================================
# Binance API 憑證
#
# 如何獲得：
# 1. 登入 Binance 帳戶
# 2. 前往「API 管理」頁面：https://www.binance.com/zh-TC/my/settings/api-management
# 3. 建立新的 API Key
# 4. 複製 API Key 和 API Secret
# 5. 啟用「啟用合約交易」權限（用於永續合約套利）
#
# 測試網：
# - 網址：https://testnet.binancefuture.com/
# - 說明：可以使用測試網練習，不會使用真實資金
BINANCE_API_KEY=your_binance_api_key_here
BINANCE_API_SECRET=your_binance_api_secret_here

# 是否使用 Binance 測試網（true=測試網, false=正式網）
BINANCE_TESTNET=true

# OKX API 憑證
#
# 如何獲得：
# 1. 登入 OKX 帳戶
# 2. 前往「API」頁面：https://www.okx.com/account/my-api
# 3. 建立新的 API Key
# 4. 複製 API Key、Secret Key 和 Passphrase
# 5. 啟用「交易」權限
#
# 測試網（模擬盤）：
# - 網址：https://www.okx.com/trade-demo
# - 說明：可以使用模擬盤練習，不會使用真實資金
# - 模擬盤需要單獨建立 API Key
OKX_API_KEY=your_okx_api_key_here
OKX_API_SECRET=your_okx_api_secret_here
OKX_PASSPHRASE=your_okx_passphrase_here

# 是否使用 OKX 模擬盤（true=模擬盤, false=正式網）
OKX_TESTNET=true

# Gate.io API 憑證
#
# 如何獲得：
# 1. 登入 Gate.io 帳戶
# 2. 前往「API 管理」頁面：https://www.gate.io/myaccount/apikeys
# 3. 建立新的 API Key
# 4. 複製 API Key 和 Secret Key
# 5. 啟用「合約交易」權限（用於永續合約套利）
#
# 注意：Gate.io 連線需要 API Key，即使只獲取公開數據（資金費率）
GATEIO_API_KEY=your_gateio_api_key_here
GATEIO_API_SECRET=your_gateio_api_secret_here

# 是否使用 Gate.io 測試網（true=測試網, false=正式網）
GATEIO_TESTNET=false

# ============================================================================
# Telegram 通知設定（選用）
# ============================================================================
# Telegram Bot Token
#
# 如何獲得：
# 1. 在 Telegram 中搜尋 @BotFather
# 2. 發送 /newbot 命令建立新的 Bot
# 3. 依照指示完成設定
# 4. 複製 Bot Token（格式：123456789:ABCdefGHIjklMNOpqrsTUVwxyz）
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# Telegram Chat ID
#
# 如何獲得：
# 1. 在 Telegram 中搜尋 @userinfobot
# 2. 啟動 Bot 會顯示您的 Chat ID（純數字，例如：123456789）
# 3. 或者，將您的 Bot 加入群組，使用群組 ID（負數，例如：-123456789）
TELEGRAM_CHAT_ID=your_telegram_chat_id_here

# ============================================================================
# 交易設定
# ============================================================================
# 最小資金費率差異閾值（觸發套利的最小費率差）
# 單位：小數（例如：0.0005 = 0.05%）
# 建議值：0.0003 - 0.001（0.03% - 0.1%）
MIN_SPREAD_THRESHOLD=0.0005

# 套利機會年化收益門檻（Feature 022）
# 單位：百分比（例如：800 = 800%）
# 說明：當年化收益 >= 此值時，交易對會被標記為套利機會
# 預設值：800（800% 年化收益）
# 建議值：500-1000，視風險偏好調整
# 「接近機會」門檻自動設為此值的 75%（例如 800 → 600%）
# OPPORTUNITY_THRESHOLD_ANNUALIZED=800

# 最大倉位大小（USD）
# 單位：美元
# 建議值：根據您的資金規模設定，建議不超過總資金的 20%
MAX_POSITION_SIZE_USD=10000

# 預設槓桿倍數
# 範圍：1-10
# 建議值：1-3（低槓桿較安全）
# ⚠️ 警告：高槓桿會增加風險，可能導致爆倉
DEFAULT_LEVERAGE=1

# ============================================================================
# 風險管理
# ============================================================================
# 每日最大虧損（USD）
# 單位：美元
# 說明：當日累計虧損達到此金額時，停止所有交易
MAX_DAILY_LOSS=1000

# 最大回撤百分比
# 單位：小數（例如：0.1 = 10%）
# 說明：當帳戶回撤達到此比例時，停止所有交易
MAX_DRAWDOWN=0.1

# 倉位大小佔帳戶比例
# 單位：小數（例如：0.1 = 10%）
# 說明：每次開倉使用帳戶餘額的此比例
POSITION_SIZE_PERCENT=0.1

# ============================================================================
# 監控與效能
# ============================================================================
# 健康檢查間隔（毫秒）
# 說明：檢查系統健康狀態的頻率
# 預設值：60000 = 1 分鐘
HEALTH_CHECK_INTERVAL_MS=60000

# 價格更新間隔（毫秒）
# 說明：從交易所拉取最新價格的頻率
# 預設值：1000 = 1 秒
# ⚠️ 注意：設定過低可能會超過 API 請求限制
PRICE_UPDATE_INTERVAL_MS=1000

# 資金費率檢查間隔（毫秒）
# 說明：檢查資金費率的頻率
# 預設值：300000 = 5 分鐘
# 建議值：300000 - 600000（5-10 分鐘）
FUNDING_RATE_CHECK_INTERVAL_MS=300000

# ============================================================================
# Proxy 設定（選用）
# ============================================================================
# HTTP/HTTPS Proxy URL
#
# 用途：
# - 當交易所 API 在您的地區受限時，可使用 proxy 連線
# - 支援 HTTP、HTTPS、SOCKS5 proxy
#
# 格式：
# - HTTP Proxy: http://host:port
# - HTTPS Proxy: https://host:port
# - SOCKS5 Proxy: socks5://host:port
# - 帶認證: http://user:password@host:port
#
# 範例：
# - PROXY_URL=http://127.0.0.1:7890
# - PROXY_URL=socks5://127.0.0.1:1080
# - PROXY_URL=https://proxy.example.com:8080
#
# 注意：
# - 留空或不設定表示不使用 proxy
# - 請確保 proxy 伺服器穩定，以免影響交易執行
PROXY_URL=

# ============================================================================
# 日誌設定
# ============================================================================
# 日誌等級
# 選項：trace, debug, info, warn, error, fatal
# 說明：
# - trace: 最詳細，包含所有訊息（開發用）
# - debug: 除錯訊息（開發用）
# - info: 一般資訊訊息（建議用於正式環境）
# - warn: 警告訊息
# - error: 錯誤訊息
# - fatal: 嚴重錯誤訊息
LOG_LEVEL=info

# 是否啟用美化日誌輸出
# 選項：true, false
# 說明：
# - true: 彩色、格式化的日誌（適合開發環境）
# - false: JSON 格式的日誌（適合正式環境和日誌收集工具）
LOG_PRETTY=true

# ============================================================================
# 記憶體監控設定
# ============================================================================
# 是否啟用記憶體監控
# 選項：true, false
# 說明：
# - true: 啟用記憶體監控，定期記錄 heap 使用量到 logs/memory/
# - false: 關閉記憶體監控，減少系統開銷
# 建議：開發和除錯時啟用，正式環境可視需求關閉
ENABLE_MEMORY_MONITOR=true

# 記憶體監控間隔（毫秒）
# 預設值：300000 = 5 分鐘
# 建議值：
# - 60000 (1 分鐘): 開發環境或問題排查時
# - 300000 (5 分鐘): 正式環境常規監控
# - 600000 (10 分鐘): 低負載環境
MEMORY_MONITOR_INTERVAL_MS=300000

# 是否啟用 Heap Snapshot 自動抓取
# 選項：true, false
# 說明：
# - true: 當 heap 增長超過閾值時自動抓取 V8 heap snapshot
# - false: 關閉自動抓取（避免影響效能）
# ⚠️ 注意：Heap snapshot 會暫停主執行緒數秒，建議 production 環境關閉
# 建議：僅在問題排查時臨時啟用
ENABLE_HEAP_SNAPSHOT=false

# Heap Snapshot 觸發閾值（MB）
# 預設值：100
# 說明：當單次記憶體增長超過此值時觸發 heap snapshot
# 建議：設定為正常波動範圍的 2-3 倍，避免誤觸發
HEAP_SNAPSHOT_THRESHOLD_MB=100

# ============================================================================
# 資產快照設定 (Feature 031)
# ============================================================================
# 是否啟用資產快照自動排程
# 選項：true, false
# 說明：啟用後會每小時自動記錄用戶的資產快照
ENABLE_ASSET_SNAPSHOT=true

# 資產快照間隔（毫秒）
# 預設值：3600000 = 1 小時
# 說明：每隔此時間會為所有有 API Key 的用戶建立資產快照
ASSET_SNAPSHOT_INTERVAL_MS=3600000

# ============================================================================
# BingX API 憑證（用於 CLI 監控）
# ============================================================================
# BingX API 憑證（用於市場數據監控 - 讀取權限即可）
#
# 如何獲得：
# 1. 登入 BingX 帳戶
# 2. 前往「API 管理」頁面
# 3. 建立新的 API Key（選擇「讀取」權限）
# 4. 複製 API Key 和 Secret Key
#
# 注意：此 API Key 僅用於獲取市場數據（價格、資金費率）
# 交易用 API Key 請在 Web 界面的 API Key 管理頁面設定
BINGX_API_KEY=your_bingx_api_key_here
BINGX_API_SECRET=your_bingx_api_secret_here

# 是否使用 BingX 測試網（true=測試網, false=正式網）
# 注意：BingX 目前沒有公開測試網，此設定僅供未來使用
BINGX_TESTNET=false

# ============================================================================
# CLI 狀態儀表板設定 (Feature 071)
# ============================================================================
# 是否啟用 CLI 狀態儀表板
# 選項：true, false
# 說明：啟用後會在啟動時顯示系統狀態儀表板
# 預設值：true
ENABLE_CLI_DASHBOARD=true

# CLI 儀表板刷新間隔（毫秒）
# 說明：狀態儀表板自動刷新的頻率
# 預設值：10000 = 10 秒
# 範圍：1000 - 60000（1 秒 - 60 秒）
CLI_DASHBOARD_INTERVAL_MS=10000

# 強制 TTY 模式（除錯用）
# 選項：true, false
# 說明：強制使用 TTY 互動模式顯示儀表板，忽略終端機偵測
# 預設值：false
# ⚠️ 注意：此選項主要用於除錯，正常情況下應使用自動偵測
CLI_DASHBOARD_FORCE_TTY=false
